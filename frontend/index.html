<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Food Nutrition Estimator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.0/vanilla-tilt.min.js"></script>
</head>
<body class="bg-pink-50 text-gray-800 scroll-smooth">

<!-- NAVBAR -->
<nav id="navbar" class="fixed top-0 left-0 w-full bg-transparent backdrop-blur-md z-50 transition-colors duration-300">
  <div class="max-w-7xl mx-auto px-6 py-3 flex justify-between items-center">
    <h1 class="text-xl font-bold text-pink-600">🍓 Nutrition Estimator</h1>
    <div class="space-x-6">
      <a href="#hero-section" class="text-white font-bold hover:text-pink-500">Home</a>
      <a href="#predict-section" class="text-white font-bold hover:text-pink-500">Predict</a>
      <a href="#facts-section" class="text-white font-bold hover:text-pink-500">Facts</a>
    </div>
  </div>
</nav>

<!-- HERO -->
<section id="hero-section" class="h-screen flex flex-col justify-center items-center text-center relative overflow-hidden pt-20">
  <video autoplay muted loop class="absolute top-0 left-0 w-full h-full object-cover z-0">
    <source src="https://www.pexels.com/download/video/9923209/" type="video/mp4">
  </video>
  <div class="absolute top-0 left-0 w-full h-full bg-black/40 z-5"></div>
  <h1 class="text-5xl font-extrabold text-white drop-shadow-2xl mb-4 relative z-10">Ultimate Food Nutrition Estimator</h1>
  <p class="text-lg italic mb-6 text-white relative z-10 drop-shadow-lg">
    “You are what you eat, so don’t be fast, cheap, easy, or fake.”
  </p>
  <button onclick="document.getElementById('predict-section').scrollIntoView({behavior:'smooth'})"
          class="bg-pink-600 text-white px-6 py-3 rounded-full shadow-lg hover:bg-pink-700 transition relative z-10">
    Let’s Estimate
  </button>
</section>

<!-- PREDICTION -->
<section id="predict-section" class="min-h-screen flex flex-col items-center justify-center p-8 relative">

  <h2 class="text-3xl font-bold text-pink-600 mb-6 relative z-10">Estimate Nutrition</h2>

  <!-- Text Form -->
  <form id="nutritionForm" class="flex gap-2 mb-4 relative z-10">
    <input type="text" id="food_name" name="food_name" placeholder="Enter food name" 
           class="p-2 border border-pink-300 rounded w-64" required>
    <button type="submit" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">Predict</button>
  </form>

  <!-- Image Form -->
  <form id="imageForm" enctype="multipart/form-data" class="flex gap-2 mb-4 relative z-10">
    <input type="file" id="food_image" name="image" accept="image/*" required>
    <button type="submit" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">Predict from Image</button>
  </form>

  <!-- Text Result -->
  <div id="result" class="bg-white border-2 border-pink-200 rounded-xl shadow-lg w-80 text-center mb-6 p-4 hidden relative z-10"></div>

  <!-- Image Result -->
  <div id="imageResult" class="bg-white border-2 border-pink-200 rounded-xl shadow-lg w-80 text-center mb-6 p-4 hidden relative z-10">
    <img id="uploaded-image" src="" alt="Uploaded Food" class="mx-auto rounded mb-2 w-48 h-48 object-cover">
    <div id="image-info"></div> <!-- This will hold the nutrient info for the uploaded image -->
  </div>

  <!-- Pie Chart -->
  <div class="w-64 h-64 mx-auto relative z-10">
    <canvas id="macroChart"></canvas>
  </div>
</section>

<!-- FACTS -->
<section id="facts-section" class="min-h-screen bg-gradient-to-r from-pink-100 to-purple-100 p-12 text-center">
  <h2 class="text-3xl font-bold text-pink-700 mb-8">Daily Nutrition Facts</h2>
  <div id="facts-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
</section>

<!-- FOOTER -->
<footer class="bg-pink-600 text-white py-6 text-center">
  <p>© 2025 Developed by Archana😊. All rights reserved.</p>
</footer>

 <script>
const form = document.getElementById('nutritionForm');
const resultDiv = document.getElementById('result');
const imageForm = document.getElementById('imageForm');
const imageResultDiv = document.getElementById('imageResult');
const uploadedImg = document.getElementById('uploaded-image');
const imageInfoDiv = document.getElementById('image-info');
const ctx = document.getElementById('macroChart').getContext('2d');
let chart;

// Text Prediction
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const food_name = document.getElementById('food_name').value;
  const response = await fetch('/predict', {
    method: 'POST',
    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
    body: `food_name=${encodeURIComponent(food_name)}`
  });
  const data = await response.json();
  resultDiv.classList.remove("hidden");
  resultDiv.innerHTML = `<div class="mb-2 font-bold text-pink-600">Food: ${food_name}</div>
    <div>🍎 Calories: ${data.Calories.toFixed(1)}</div>
    <div>🥩 Protein: ${data.Protein.toFixed(1)} g</div>
    <div>🍞 Carbs: ${data.Carbs.toFixed(1)} g</div>
    <div>🧈 Fat: ${data.Fat.toFixed(1)} g</div>`;
  updateChart(data.Protein, data.Carbs, data.Fat);
});

// Image Prediction
imageForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const imageFile = document.getElementById('food_image').files[0];
  if (!imageFile) return alert("Please select an image");

  const formData = new FormData();
  formData.append('image', imageFile);

  const response = await fetch('/predict-image', { method: 'POST', body: formData });
  const data = await response.json();

  imageResultDiv.classList.remove("hidden");
  
  uploadedImg.src = URL.createObjectURL(imageFile);
  imageInfoDiv.innerHTML = '';

  // Add new nutrient info
  imageInfoDiv.innerHTML = `
    <div class="mb-2 font-bold text-pink-600">Detected Food: ${data.food_name}</div>
    <div>🍎 Calories: ${data.Calories.toFixed(1)}</div>
    <div>🥩 Protein: ${data.Protein.toFixed(1)} g</div>
    <div>🍞 Carbs: ${data.Carbs.toFixed(1)} g</div>
    <div>🧈 Fat: ${data.Fat.toFixed(1)} g</div>
  `;

  updateChart(data.Protein, data.Carbs, data.Fat);
});

// Updates Pie Chart
function updateChart(protein, carbs, fat) {
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Protein', 'Carbs', 'Fat'],
      datasets: [{
        data: [protein, carbs, fat],
        backgroundColor: ['#ff9999', '#66b3ff', '#99ff99'],
        borderWidth: 2, borderColor: "#fff"
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
}

// Load Facts
async function loadFacts() {
  const response = await fetch('/facts');
  const facts = await response.json();
  const container = document.getElementById('facts-container');
  container.innerHTML = '';
  Object.entries(facts).forEach(([key, value]) => {
    const card = document.createElement('div');
    card.className = "bg-white rounded-xl shadow-lg p-6 transform transition hover:shadow-2xl";
    card.innerHTML = `<h3 class="text-xl font-bold text-pink-600 mb-2">${key}</h3><p class="text-gray-700">${value}</p>`;
    container.appendChild(card);
  });
}
loadFacts();
</script>

</body>
</html>
